pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init() 
    --skelly
    pl={}
    pl.x=64 pl.y=64
    pl.w=16  pl.h=16
    pl.hitbox={x=5,y=0,w=5,h=16}
    pl.spd=2
    pl.vely=0
    pl.jspd=15
    pl.grounded=false
    pl.canjump=false
    pl.update=function()
        local hit=collision(pl)
        if hit then
            pl.grounded=true
            pl.canjump=true
            pl.vely=0
            pl.y=hit.y+hit.hitbox.y-pl.hitbox.y-pl.hitbox.h
        end
        pl.move()
    end
    pl.move=function() 
        --input
        if(btn(0)) pl.x-=pl.spd
        if(btn(1)) pl.x+=pl.spd
        if btn(2)
        and pl.canjump 
        and pl.grounded then
            pl.vely=-pl.jspd 
            pl.canjump=false
            pl.grounded=false
        end
        
        --calcs
        if(not pl.grounded) then 
            pl.vely+=grav
        end
    
        --player y
        pl.y+=pl.vely
    end
    pl.draw=function()
        spr(1,pl.x,pl.y,2,2)
    end
    
    --platforms
    platforms={}
    add(platforms, {
        x=0,
        y=115,
        w=128,
        h=8,
        sp_w=8,
        sp_h=8
    })
    
    --camera
    cam={x=0,y=0}
    
    --globals
    grav=2
    cur_lvl=1
    objects={}
    types={wall=0}
    
    load_level(1)
end 

function _update() 
    pl.update()
    lerpcam()
end

function _draw()
    cls()
    draw_level(cur_lvl)
    --sspr(56,0,8,8,0,115,128,8)
    pl.draw()
    --rect(pl.x+pl.hitbox.x,pl.y,pl.x+pl.hitbox.x+pl.hitbox.w,pl.y+pl.h,10)
end
   

-- function ground_collision() 
--     local plat
--     for i=1,count(platforms) do
--         plat=platforms[i]
--         if (pl.x+pl.hitbox.x<plat.x+plat.w and 
--             pl.x+pl.hitbox.x+pl.hitbox.w>plat.x and
--             pl.y+pl.h+pl.vely>=plat.y)
--         then
--             return plat
--         end
--     end
--     return false
-- end


function collision(this)
    for i=1,count(objects) do
        local obj=objects[i]
        if obj~=nil and obj~=this and
            this.x+this.hitbox.x+this.hitbox.w>obj.x+obj.hitbox.x and 
            this.x+this.hitbox.x<obj.x+obj.hitbox.x+obj.hitbox.w and
            this.y+this.hitbox.y+this.hitbox.h>obj.y+obj.hitbox.y and 
            this.y+this.hitbox.y<obj.y+obj.hitbox.y+obj.hitbox.h then
            return obj 
        end	
    end
    return nil
end
   
function load_level(lnum)
    for tx=0,127 do
        for ty=0,15 do 
            local tile = mget(tx,(lnum-1)*16+ty)
            if (tile==7) then 
                init_obj(types.wall,tx*8,ty*8)              
            end
        end
    end
end

function init_obj(typ,x,y)
    local obj={}
    obj.typ=typ
    obj.x=x obj.y=y
    if (typ==types.wall) then 
        obj.w=8 
        obj.h=8
        obj.hitbox={x=0,y=0,w=8,h=8}
    end
    add(objects, obj)
end

function draw_level(lnum)
    if(lnum==1) then
        map(0,0,0,0,127,16)
    end
end

function lerpcam() 
    local x_center=(pl.x+pl.w/2)-64
    cam.x=cam.x+0.1*(x_center-cam.x)
    camera(cam.x,0)
end

function pattern_testing()
    fillp(0b010101001010010)
    --circfill(64,64,20, 0x4e)
    rectfill(0,0,128,128)
end
   
   --todo:
   --horizontal inertia
   --tilemap collisions
   
__gfx__
00000000000007777770000000000777777000000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00000000000077777777000000007777777700000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00700700000077577577000000007757757700000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00077000000077777777000000007777777700000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00077000000077777777000000007777777700000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00700700000007777770000000000777777000000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00000000000007777770000000000777777000000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00000000000007888870000000000788887000000000000000000000555555558888888800000000000000000000000000000000000000000000000000000000
00000000000700000000700000070000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007000777700070000700077777007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007000000000070000700000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007007077070070000700707707007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000070070000007007007007000000700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000070077700777007007007770077700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007077700777070000707770077707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000007000070000000000700007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000000000000000000000000000000000000000000000000000000000000000700000007000007000700000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000000000000000000000000000000000000000000000000000707000a2a200000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000000000000a10000000000000000000000000000000000000000000000a200a2a20000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000009090900090909090909090909000909090009090000070
70000000000000a19090909090909000000000a10000000000a10070707070a2a2a2000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000009090909000000000000000000000000000000090000070
7000000000000090909090909090909000000000000000000000a2a2a2a200000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70000061000000909070707070909090000000000000707070000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70006161000000909090909090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070
70006161000000009090009090900000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b1b1a1a1a1a170
70707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070
70707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707080
__map__
0838383838383838383838383838380000000000000000000000002b2b2b2b2b2b2b2b2b2b2b2b2b00000000000000000000000000000000000000000000001818181818181818181818181818181818181818181818181818181818001800001818181800000000001818000000000000000000000000000000000000000008
0738000000000038383838383838383838383800000000002b2b2b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001800001800001800001800181800000000000000000018181818181800000000000000000000000000000000000000000007
07381a1a1a1a3838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0738000038383838383838383838383838380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0738383838383838383838383838383838380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0738383838003838383838383838383838000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0738383838383838383838000038003838000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0700380000000000380000000000000038000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0700000000000000000000000000000000000000000000000007070707070700000000000000000000000000000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
070000000a0a0a00000000000000000000000000000000000000000000000000000000000000000000000000000007070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
070000000a0a0a00000000000000000000000000000000000000000000000000000007070000000707000000000000000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
07000000000a0a0a000a0a000000000707070707070000000000000000000000000000000000000000000000000000000007070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
070000000a0a0a0a0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e1e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007
0707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707070707
1a1a1a1a1a1a1a000000000000000000000000000000000000000000001a1a1a1a1a1a1a1a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c
